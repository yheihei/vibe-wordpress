# 全画面ヒーローヘッダーとスクロール連動ヘッダー表示 - 設計書

## 実装日
2025年1月5日

## 概要
ホームページのファーストビューでヒーローヘッダーを全画面表示し、スクロールに応じてナビゲーションヘッダーをCRTスキャンラインエフェクトで表示する機能を実装しました。

## 実装内容

### 1. コンポーネント構成

#### useScrollVisibility フック (`/src/hooks/useScrollVisibility.ts`)
- スクロール位置を監視し、ヘッダーの表示/非表示を制御
- パフォーマンス最適化のため`requestAnimationFrame`を使用
- スキャンラインエフェクトのタイミング制御

#### HeaderWrapper コンポーネント (`/src/components/HeaderWrapper.tsx`)
- パス名に基づいてヘッダーの表示ロジックを切り替え
- ホームページ: スクロールベースの条件付き表示
- その他のページ: 常に表示
- ScanlineEffectコンポーネントとの連携

#### ScanlineEffect コンポーネント (`/src/components/ScanlineEffect.tsx`)
- CRT起動風のスキャンラインアニメーション
- グリッチラインでリアルなCRT感を演出

#### HeroHeader コンポーネントの更新
- スクロールインジケーター追加
- 「PRESS ↓ TO CONTINUE」テキストとアニメーション矢印
- クリックでスムーズスクロール機能

### 2. CSSアニメーション (`/src/app/globals.css`)

#### スキャンラインエフェクト
```css
.scanline {
  background: linear-gradient(
    to bottom,
    transparent,
    rgba(0, 255, 0, 0.8),
    #00ff00,
    rgba(0, 255, 0, 0.8),
    transparent
  );
  box-shadow: 0 0 10px #00ff00, 0 0 20px rgba(0, 255, 0, 0.5);
  animation: scanline-move 400ms linear forwards;
}
```

#### グリッチライン
- ランダムな横線でCRTノイズを表現
- 2本のラインが異なるタイミングで点滅

#### ヘッダー表示アニメーション
- `header-reveal`: opacity と transform でスムーズに出現

#### スクロールインジケーター
- バウンスアニメーションで注意を引く
- ホバー時にアニメーション速度変化

### 3. 動作仕様

#### ホームページでの動作
1. 初期状態: ヘッダー非表示、ヒーローヘッダー全画面表示
2. ビューポート高さ（100vh）を超えてスクロール時:
   - スキャンラインエフェクト発動（400ms）
   - エフェクト開始100ms後にヘッダー表示開始
   - 600ms後にエフェクト終了
3. 上にスクロールしてヒーローエリアに戻る時: ヘッダー非表示

#### その他のページでの動作
- ヘッダーは常に表示（従来通り）

### 4. パフォーマンス最適化

- `requestAnimationFrame`によるスクロールイベントの最適化
- スクロールイベントに`passive: true`オプション使用
- 不要な再レンダリングを防ぐための状態管理

## 技術的な詳細

### スクロール閾値
- デフォルト: 100px（ビューポート高さ - 100px でトリガー）

### z-index階層
- ヒーローヘッダー内要素: 7-101
- スクロールインジケーター: 50
- ヘッダー: 200（sticky）
- スキャンラインエフェクト: 300

### タイミング詳細
- スキャンライン移動: 400ms
- ヘッダー表示遅延: 100ms
- エフェクト全体: 600ms
- ヘッダーフェードイン: 300ms

## テスト結果
- ✅ ホームページでヘッダーが初期非表示
- ✅ スクロール時にスキャンラインエフェクト表示
- ✅ エフェクト後にヘッダー表示
- ✅ 上スクロールでヘッダー非表示
- ✅ 他ページでヘッダー常時表示
- ✅ スクロールインジケーター動作確認
- ✅ モバイル・デスクトップ両対応

## 今後の改善案
- スキャンラインの色やスピードのカスタマイズ機能
- 音響効果の追加（オプション）
- より詳細なグリッチエフェクト
- パララックススクロール効果の追加

## 修正履歴
### 2025年1月5日 - ヘッダー表示問題の修正
- **問題**: HeaderWrapperで余分なdivでラップしたことにより、Headerコンポーネントのstickyポジショニングが効かなくなっていた
- **解決**: 
  - Headerコンポーネントに`className`プロップを追加
  - HeaderWrapperで直接Headerコンポーネントに`header-reveal`クラスを渡すように変更
  - 余分なdivラッパーを削除してstickyポジショニングを維持

### 2025年1月5日 - ヘッダースライドアウトアニメーション追加
- **要望**: ヒーローヘッダーに戻る際、ヘッダーが突然消えるのではなく上に引っ込むアニメーションを追加
- **実装**: 
  - `header-hide`クラスとアニメーションを追加（300ms、ease-in）
  - useScrollVisibilityフックを改修:
    - `isHeaderMounted`: ヘッダーのDOM存在を管理
    - `headerAnimationClass`: 'header-reveal' または 'header-hide' を管理
  - ヘッダー非表示時は、アニメーション開始後300ms待ってからDOMから削除
  - スムーズで自然な画面遷移を実現

### 2025年1月5日 - CRTスキャンラインエフェクト削除
- **要望**: ヘッダー出現時のCRTスキャンラインエフェクト表示をやめる
- **実装**:
  - useScrollVisibilityフックから`showScanlineEffect`関連のコードを削除
  - HeaderWrapperから`ScanlineEffect`コンポーネントの参照を削除
  - シンプルなフェードイン/スライドアウトアニメーションのみに変更
  - より洗練されたモダンな印象に